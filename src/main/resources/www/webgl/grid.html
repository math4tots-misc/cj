<html>
  <head>
    <style>
      body { margin: 0; }
      canvas {
        border: solid;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <!-- vertex shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
      #version 300 es
      precision mediump float;

      in float aVertexData;
      out float vVertexData;
      uniform float uNRows;
      uniform float uNCols;

      // each cell has corners numbered
      //
      // 0  -  2
      //    \  |
      //       1
      //
      // 3
      // | \
      // 4 - 5

      void main(void) {
        int nrows = int(uNRows);
        int ncols = int(uNCols);
        int corner = gl_VertexID % 6;
        int pixelID = gl_VertexID / 6;
        int row = pixelID / ncols;
        int col = pixelID % ncols;

        float pixelWidth = 2.0 / uNCols;
        float pixelHeight = 2.0 / uNRows;

        float x = -1.0 + pixelWidth * float(col);
        float y = 1.0 - pixelHeight * float(row);

        if (corner == 1 || corner == 2 || corner == 5) {
          x += pixelWidth;
        }

        if (corner == 1 || corner == 4 || corner == 5) {
          y -= pixelHeight;
        }

        vVertexData = aVertexData;
        gl_PointSize = uNRows + uNCols;
        gl_Position = vec4(x, y, 0.0, 1.0);
      }
    </script>

    <!-- fragment shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
      #version 300 es
      precision mediump float;

      in float vVertexData;
      out vec4 fragColor;

      void main(void) {
        fragColor = vec4(vVertexData, vVertexData, vVertexData, 1.0);
      }
    </script>
    <script src="main.js"></script>
  </body>
</html>
